<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>thouhou test</title>
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="#page-top">Start Bootstrap</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="#projects">Projects</a></li>
                        <li class="nav-item"><a class="nav-link" href="#signup">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead">
            <div class="container px-4 px-lg-5 d-flex h-100 align-items-center justify-content-center">
                <div class="d-flex justify-content-center">
                    <div class="text-center">
                        <h1 class="mx-auto my-0 text-uppercase">thouhou test</h1>
                        <h3 class="text-white-50 mx-auto mt-2 mb-5">얼굴상을 동방프로젝트 캐릭터들과 대조하여 보여줍니다.</h3>
                        <h3 class="text-white-50 mx-auto mt-2 mb-5">해당 사이트는 수익을 추구하지 않습니다.</h3>
                        
                        
                        <div id="upload-area">
                            <span><button type="button" class="btn btn-primary">upload the image</button></span>
                            <br />
                            <span></span>
                            <input id="upload-input" style="display: none;" type="file" accept="image/*" onchange="readFile(this.files[0]);" />
                        </div>
                        <div id="loading-area" style="display: none;">
                            <span>🏃〰️</span>
                            <br />
                            <span style="color: white;">loading the AI model.</span>
                        </div>
                        <div id="result-area" style="display: none;">
                            <img id="upload-image" src="#" alt="your image" />
                            <div id='label-container'></div>
                        </div>
                        
                        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
                        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
                        <script type="text/javascript">
                            const URL = "https://teachablemachine.withgoogle.com/models/CkvFRl6kU/";
                    
                            let model, labelContainer, maxPredictions;
                            let isModelReady = false;
                            let input = document.getElementById("upload-input");
                            let image = document.getElementById("upload-image");
                            let uploadArea = document.getElementById("upload-area");
                            let loadingArea = document.getElementById("loading-area");
                            let resultArea = document.getElementById("result-area");
                            let retryArea = document.getElementById("retry-area")
                            const reader = new FileReader();
                    
                            async function readFile(file) {
                                uploadArea.style.display = "none";
                                if (isModelReady === false) {
                                    loadingArea.style.display = "block";
                                    await init();
                                }
                                reader.readAsDataURL(file);
                            }
                    
                            reader.onload = async function(event) {
                                await image.setAttribute('src', event.target.result);
                                await predict();
                                loadingArea.style.display = "none";
                                resultArea.style.display = "block";
                                retryArea.style.display = "block";
                            };

                            uploadArea.onclick = function() {
                                input.click();
                            }

                            uploadArea.ondragover = function(event) {
                                event.preventDefault();
                            }

                            uploadArea.ondrop = function(event) {
                                event.preventDefault();
                                const file = event.dataTransfer.files[0];
                                readFile(file);
                            }

                            resultArea.onclick = function() {
                                retryArea.style.display = "none";
                                resultArea.style.display = "none";
                                uploadArea.style.display = "block";
                                input.value = "";
                            }
                    
                            async function init() {
                                const modelURL = URL + "model.json";
                                const metadataURL = URL + "metadata.json";
                    
                                model = await tmImage.load(modelURL, metadataURL);
                                maxPredictions = model.getTotalClasses();
                                labelContainer = document.getElementById("label-container");
                    
                                for (let i = 0; i < maxPredictions + 1; i++) {
                                    labelContainer.style.color="white";
                                    labelContainer.appendChild(document.createElement("div"));
                                }
                            }
                    
                            async function predict() {
                                const prediction = await model.predict(image);
                                //prediction.style.color="white";
                                console.log(prediction);
                                prediction.sort((x, y) => y.probability - x.probability);
                    
                                switch (prediction[0].className) {
                                    case "이자요이 사쿠야":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>이자요이 사쿠야</h3></center>";
                                        break;
                                    case "키리사메 마리사":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>키리사메 마리사</h3></center>";
                                        break;
                                    case "콘파쿠 요우무":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>콘파쿠 요우무</h3></center>";
                                        break;
                                    case "코메이지 코이시":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>코메이지 코이시</h3></center>";
                                        break;
                                    case "하쿠레이 레이무":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>하쿠레이 레이무</h3></center>";
                                        break;
                                    case "레밀리아 스칼렛":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>레밀리아 스칼렛</h3></center>";
                                        break;
                                    case "앨리스 마가트로이드":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>앨리스 마가트로이드</h3></center>";
                                        break;
                                    case "플랑도르 스칼렛":
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>플랑도르 스칼렛</h3></center>";
                                        break;
                                    default:
                                        labelContainer.childNodes[0].innerHTML = "<center><h3>몰루겟슴</h3></center>";
                                        break;
                                }
                    
                                for (let i = 0; i < maxPredictions; i++) { 
                                    const classPrediction = prediction[i].className + ": " + Math.round(prediction[i].probability * 100) + "%";
                                    labelContainer.childNodes[i+1].innerHTML = classPrediction;
                                }
                                isModelReady = true;
                            }
                        </script>
                    </div>
                </div>
            </div>
        </header>
        <!-- About-->
        <section class="about-section text-center" id="about">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-lg-8">
                        <h2 class="text-white mb-4">.</h2>
                        <p class="text-white-50">
                            .
                            <a href="https://startbootstrap.com/theme/grayscale/">.</a>
                            .
                        </p>
                    </div>
                </div>
                <img class="img-fluid" src="assets/img/ipad.png" alt="..." />
            </div>
        </section>
        <!-- Contact-->
        <div id="upload-area">
            <span><div class="d-grid gap-2 col-15 mx-auto"><a class="btn btn-primary" href=""> remove the image </a></div></span>
            <input id="upload-input" style="display: none;" type="file" accept="image/*" onchange="readFile(this.files[0]);" />
        </div>
        <section class="contact-section bg-black">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5">
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-map-marked-alt text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Address</h4>
                                <hr class="my-4 mx-auto" />
                                <div class="small text-black-50">4923 Market Street, Orlando FL</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-envelope text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Email</h4>
                                <hr class="my-4 mx-auto" />
                                <div class="small text-black-50"><a href="#!">hello@yourdomain.com</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card py-4 h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-mobile-alt text-primary mb-2"></i>
                                <h4 class="text-uppercase m-0">Phone</h4>
                                <hr class="my-4 mx-auto" />
                                <div class="small text-black-50">+1 (555) 902-8832</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="social d-flex justify-content-center">
                    <a class="mx-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                    <a class="mx-2" href="#!"><i class="fab fa-twitter"></i></a>
                    <a class="mx-2" href="#!"><i class="fab fa-github"></i></a>
                </div>
            </div>
        </section>
        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50"><div class="container px-4 px-lg-5">Copyright &copy; Your Website 2023</div></footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>
